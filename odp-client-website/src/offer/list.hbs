{{#> layout/base }}
{{#*inline "content-block"}}

{{#unless (eq category.path '$') }}
<h2>
  {{#split category.path '.' }}
  <a href="/list/{{ prefix }}.{{ part }}">{{ part }}</a>

  {{#unless @last }}
  <small> > </small>
  {{/unless}}
  {{/split }}
</h2>
{{/unless}}

<h4>Podkategorije</h4>
<ul>
  {{#each category.childrenNames }}
  <li><a href="/list/{{ @root.category.path }}.{{ this }}">{{ this }}</a></li>
  {{/each }}
</ul>

<h4>Filtri</h4>

<form method="GET" action="">
  {{#eachKey category.fields }}
  <div>
    <label>{{ key }}</label>
    <br />

    {{#if (eq value.type 'CATEGORICAL') }}
    {{#each value.categorical.members }}
    <input type="checkbox" name="f.{{ ../key }}" id="{{ ../key }}-{{ this }}" value="{{ this }}"
      {{#if (isFieldChecked @root.lastQuery ../key this) }}checked{{/if}}>
    <label for="{{ ../key }}-{{ this }}"> {{ this }}</label>
    <br />
    {{/each }}
    {{/if }}
    {{#if (eq value.type 'NUMERIC') }}
    <input type="number" name="f.{{ key }}.min" placeholder="{{ value.numeric.min }}"
      value="{{lookup @root.lastQuery (plus 'f.' (plus key '.min') ) }}">
    -
    <input type="number" name="f.{{ key }}.max" placeholder="{{ value.numeric.max }}"
      value="{{lookup @root.lastQuery (plus 'f.' (plus key '.max') ) }}">
    {{ value.numeric.unit }}
    <br />
    {{/if }}

  </div>
  {{/eachKey }}
  <br>
  <button type="submit">Filtriraj</button>
</form>

<hr />

<h3>Ponudbe</h3>

<small>Vseh: {{ offerPage.total }}</small>

{{#each offerPage.content }}
<article style="display: flex;">
  <div>
    <h5><a href="/offer/{{id}}">{{ title }}</a></h5>

    {{#if price }}
    {{ price.amount }} {{ price.currency }}
    {{/if}}

    <br />

    {{#eachKey @root.category.fields }}

    {{#if (lookup (lookup @root.offerQuery 'fields') key) }}
    {{#with (lookup ../fields key) }}
    <small>{{ ../key }}: </small>{{ this }} {{ ../value.numeric.unit }}<br />
    {{/with }}
    {{/if}}

    {{/eachKey }}
  </div>
  <div style="flex-grow: 1;"></div>
  <div>
    <img height="150" src="{{ images.[0] }}" />
  </div>
</article>
{{/each }}

{{/inline}}
{{/layout/base}}